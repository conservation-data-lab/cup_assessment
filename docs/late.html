<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Central Upper Peninsula Vegetation Assessment - Late Succession Habitat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Central Upper Peninsula Vegetation Assessment</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./current.html" rel="" target="">
 <span class="menu-text">Current</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./late.html" rel="" target="" aria-current="page">
 <span class="menu-text">Late Succession</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./fire.html" rel="" target="">
 <span class="menu-text">Wildfire Exposure</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background-and-summary" id="toc-background-and-summary" class="nav-link active" data-scroll-target="#background-and-summary">Background and summary</a></li>
  <li><a href="#upland-late-succession-habitat" id="toc-upland-late-succession-habitat" class="nav-link" data-scroll-target="#upland-late-succession-habitat">Upland late succession habitat</a></li>
  <li><a href="#riparian-late-succession-habitat" id="toc-riparian-late-succession-habitat" class="nav-link" data-scroll-target="#riparian-late-succession-habitat">Riparian late succession habitat</a></li>
  <li><a href="#change-in-amounts-of-late-succession-habitats-past-to-present" id="toc-change-in-amounts-of-late-succession-habitats-past-to-present" class="nav-link" data-scroll-target="#change-in-amounts-of-late-succession-habitats-past-to-present">Change in amounts of late succession habitats, past to present</a></li>
  <li><a href="#other-datasets" id="toc-other-datasets" class="nav-link" data-scroll-target="#other-datasets">Other datasets</a>
  <ul class="collapse">
  <li><a href="#mature-and-old-growth-data-from-the-us-forest-service-usfs" id="toc-mature-and-old-growth-data-from-the-us-forest-service-usfs" class="nav-link" data-scroll-target="#mature-and-old-growth-data-from-the-us-forest-service-usfs">Mature and Old Growth Data from the US Forest Service (USFS)</a></li>
  <li><a href="#mature-and-old-growth-mapping-effort-by-barnett-et-al.-2023" id="toc-mature-and-old-growth-mapping-effort-by-barnett-et-al.-2023" class="nav-link" data-scroll-target="#mature-and-old-growth-mapping-effort-by-barnett-et-al.-2023">Mature and Old-Growth mapping effort by Barnett et al.&nbsp;(2023)</a></li>
  <li><a href="#mature-and-old-growth-contributions-project-by-dellasala-et-al.-2022" id="toc-mature-and-old-growth-contributions-project-by-dellasala-et-al.-2022" class="nav-link" data-scroll-target="#mature-and-old-growth-contributions-project-by-dellasala-et-al.-2022">Mature and Old-Growth Contributions project by DellaSala et al.&nbsp;(2022)</a></li>
  </ul></li>
  <li><a href="#notes-on-landfire-data" id="toc-notes-on-landfire-data" class="nav-link" data-scroll-target="#notes-on-landfire-data">Notes on LANDFIRE data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Late Succession Habitat</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="background-and-summary" class="level2">
<h2 class="anchored" data-anchor-id="background-and-summary">Background and summary</h2>
<p>The Biden Administration has taken significant steps to protect old growth and mature forests in the United States. Their Executive Order <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2022/04/22/executive-order-on-strengthening-the-nations-forests-communities-and-local-economies/">‘Strengthening the Nation’s Forests, Communities, and Local Economies’</a> mandates the Department of Agriculture and the Department of the Interior to inventory and publicly disclose information about old-growth and mature forests on Federal lands. This initiative has sparked interest among non-profit organizations and local governments, particularly in the Central Upper Peninsula.</p>
<p>Here we explore ‘late-succession’ habitat as defined by LANDFIRE in the <a href="https://landfire.gov/bps-models.php">Biophysical Settings models and descriptions</a> which is specifically defined for each BpS (historical ecosystem).</p>
<p><em>Note: late succession does not necessarily equal ‘mature’ or ‘old growth’, and is widely defined for some types.</em></p>
<p><strong>We found:</strong></p>
<ol type="1">
<li>Central Upper Peninsula has substantial ‘late-succession’ habitat.</li>
<li>Most of this habitat is found in riparian and fire-adapted ecosystems.</li>
<li>However, there has been a significant loss of late-succession habitat in the ‘Northern Hardwoods Forest - Hemlock’ ecosystem.</li>
<li>It’s important to note that these habitat definitions primarily consider canopy cover and height, without accounting for biodiversity metrics.</li>
</ol>
</section>
<section id="upland-late-succession-habitat" class="level2">
<h2 class="anchored" data-anchor-id="upland-late-succession-habitat">Upland late succession habitat</h2>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/late_upland_current.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="riparian-late-succession-habitat" class="level2">
<h2 class="anchored" data-anchor-id="riparian-late-succession-habitat">Riparian late succession habitat</h2>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/late_riparian_current.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="change-in-amounts-of-late-succession-habitats-past-to-present" class="level2">
<h2 class="anchored" data-anchor-id="change-in-amounts-of-late-succession-habitats-past-to-present">Change in amounts of late succession habitats, past to present</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="late_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="other-datasets" class="level2">
<h2 class="anchored" data-anchor-id="other-datasets">Other datasets</h2>
<p>Above we explored “late-succession” habitat, which might be considered to be the ‘top of the funnel’ or widest possible way to look at later stages of ecosystem development. Below we explore some other related datasets currently available.</p>
<section id="mature-and-old-growth-data-from-the-us-forest-service-usfs" class="level3">
<h3 class="anchored" data-anchor-id="mature-and-old-growth-data-from-the-us-forest-service-usfs">Mature and Old Growth Data from the US Forest Service (USFS)</h3>
<p>To support “Executive Order 14072 (also known as “Strengthening the Nation’s Forests, Communities, and Local Economies”)“, USFS scientists have defined and mapped ‘mature’ and ‘old-growth’ forests on USFS and Bureau of Land Management lands of the US. Their definitions are largely based on relatively reliably mapped characteristics of tree diameter and trees per acre.</p>
<p>At time of this assessment, raw data was not available for further assessment to our knowledge.</p>
<p><br></p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/usfs_mog_viewer.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Screenshot of the USFS Mature and Old-Growth Forest Map.</figcaption>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>For the Central Upper Peninsula area, a few things stand out from their map:</p>
<ul>
<li>There are no ‘High Old-Growth’ areas.</li>
<li>High ‘Mature/Low Old-Growth’ areas are mapped in the eastern portion of the assessment area, largely in line with Pictured Rocks National Lakeshore, and the western area of the Hiawatha National Forest.</li>
</ul>
<p>We strongly recommend reading the full report, available <a href="https://www.fs.usda.gov/sites/default/files/mature-and-old-growth-forests-tech.pdf">here</a>, and exploring the <a href="https://experience.arcgis.com/experience/37cb7e33db6949c79f1f87f87968e51a/page/Simple-View/">data viewer</a>.</p>
</section>
<section id="mature-and-old-growth-mapping-effort-by-barnett-et-al.-2023" class="level3">
<h3 class="anchored" data-anchor-id="mature-and-old-growth-mapping-effort-by-barnett-et-al.-2023">Mature and Old-Growth mapping effort by Barnett et al.&nbsp;(2023)</h3>
<p>In a recently published <a href="https://www.frontiersin.org/articles/10.3389/ffgc.2022.1070372/full">paper</a>, Barnett et al.&nbsp;(2023) classified, inventoried and mapped mature and old-growth (MOG) forests for the US. Whereas many MOG mapping attempts use some combination of tree height and/or age and/or density, the authors assessed carbon accumulation, and assumed (briefly) that old-growth occurred:</p>
<blockquote class="blockquote">
<p>“…at the age when the density of total forest carbon stored in live and dead biomass reaches 95% of the empirically derived maximum, and the mature forest stage as occurring between the peak average carbon increment and the age of onset of old growth.”</p>
</blockquote>
<p>At time of this assessment, raw data was not available for further assessment to our knowledge. However from <a href="https://www.frontiersin.org/files/Articles/1070372/ffgc-05-1070372-HTML/image_m/ffgc-05-1070372-g008.jpg">Figure 8</a> in the paper a few patterns jump out:</p>
<ul>
<li>Most of the Upper Peninsula is mapped as ‘young’ or ‘mature’.<br>
</li>
<li>There appear to be scattered pixels (small areas) with ‘Old-Growth’ scattered around the area, with no discernible concentrations of old-growth.</li>
</ul>
</section>
<section id="mature-and-old-growth-contributions-project-by-dellasala-et-al.-2022" class="level3">
<h3 class="anchored" data-anchor-id="mature-and-old-growth-contributions-project-by-dellasala-et-al.-2022">Mature and Old-Growth Contributions project by DellaSala et al.&nbsp;(2022)</h3>
<p>Authors of this <a href="https://www.frontiersin.org/articles/10.3389/ffgc.2022.979528/full">paper</a> used combinations of forest canopy height, cover and above-ground living biomass to map mature and old-growth forests (among many other things). To summarize, the authors held workshops with scientists to develop ‘rulesets’ or thresholds of the three aforementioned parameters for each of 28 forest types groups, then combined the necessary datasets to map mature and old-growth forests.</p>
<p>The authors do share their datasets at https://www.matureforests.org/data. Here’s a quick map of ‘mature’ forest pixels for the analysis area.</p>
<p><br></p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/della_sala_mature.jpg" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Map of mature areas as mapped by Della-Sala et al.&nbsp;(2022).</figcaption>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>This map most closely aligns with ours, identifying a substantial amount of the analysis area as ‘mature’.</p>
</section>
</section>
<section id="notes-on-landfire-data" class="level2">
<h2 class="anchored" data-anchor-id="notes-on-landfire-data">Notes on LANDFIRE data</h2>
<p>In LANDFIRE, late-succession was not specifically designed for old-growth/mature forest identification. We use LANDFIRE data here because:</p>
<ul>
<li>There are robust descriptions and ecological models for each ecosystem that have been peer reviewed. Learn more about the process from <a href="https://esajournals.onlinelibrary.wiley.com/doi/pdf/10.1002/ecs2.3484">Blankenship et al., (2021)</a>, and <a href="https://www.mdpi.com/2073-445X/11/1/28/pdf">Swaty et al., (2021)</a>.</li>
<li>The datasets and models cover all lands, not just agency lands for example.</li>
<li>Late succession as defined in the LANDFIRE models and descriptions is ‘highly-inclusive’, and can serve to highlight areas for more detailed field examinations.</li>
<li>LANDFIRE’s view of ecosystems includes natural disturbances (including Indigenous burning, wildfires, windthrow, etc.), which is in line with current ecological theory. This is particularly important in disturbance-driven ecosystems such as the Northern Pine(-Oak) Forests which would have had frequent surface fires prior to European Settlement. These fires resulted in a fair amount of ’Late-Open” successional habitat.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>